
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>センサー値を表示</title>
<script>
var lastTime = 0;
var last = 0;
var max = 0;
var def = 0;
var lastxyz = 0;
var speed = 0;
var maxspeed = 0;
//位置情報取得
 window.onload = function(){
    navigator.geolocation.watchPosition(update); //現在位置情報を定期的に監視

    // navigator.geolocation.getCurrentPosition(); //現在位置情報を取得
    // navigator.geolocation.clearWatch(); //watchPosition()での監視を中止
}
function update(position){
    //下記すべての情報が取得できるわけでは無い
    var lat = position.coords.latitude; //緯度
    var lng = position.coords.longitude; //経度
    var alt = position.coords.altiude; //高度
    var acc = position.coords.accuracy; //緯度経度の誤差
    var alc = position.coords.altiudeAccuracy; //高度の誤差
    var hed = position.coords.heading; //方角
    var spe = position.coords.speed; //スピード

    var html ="";
        html += "緯度:" + lat + "<br>";
        html += "経度:" + lng + "<br>";
        html += "高度:" + alt + "<br>";
        html += "緯度経度誤差:" + acc + "<br>";
        html += "高度誤差:" + alc + "<br>";
        html += "方角:" + hed + "<br>";
        html += "速度:" + spe + "<br>";

    document.getElementById("geolocation").innerHTML = html;
}

//デジタルコンパス情報取得&ジャイロセンサー情報
window.addEventListener("deviceorientation", function(evt){
    //デジタルコンパス情報取得
    var ch = evt.webkitCompassHeading;
    var chAcc = evt.webkitCompassAccuracy;
    var html ="";
        html += "方角："+ch
        html += "　誤差："+chAcc;
    document.getElementById("compass").innerHTML = html;

    //ジャイロセンサー情報取得
    var alpha = evt.alpha;   // z-axis
    var beta = evt.beta;     // x-axis
    var gamma = evt.gamma;   // y-axis
    var html ="";
        html += 'Z回転(alpha):' + alpha + "<br>";
        html += "X回転(beta):" + beta + "<br>";
        html += "Y回転(gumma):" + gamma;
    document.getElementById("gyroscope").innerHTML = html;

}, false);

//加速度センサー情報取得
window.addEventListener("devicemotion", function(evt){

  var floorx = function(c) {
      return Math.floor(c*100)/100;
  };
   //加速度
   var x = evt.acceleration.x;
   var y = evt.acceleration.y;
   var z = evt.acceleration.z;
   var xx = x*x;
   var yy = y*y;
   var zz = z*z;

   //   var xyz = floorx(Math.sqrt( floorx(xx) + floorx(yy) + floorx(zz) ));
      var xyz = Math.sqrt( xx + yy + zz );
   if (xyz > max){
     max = xyz;
     document.getElementById("max").innerHTML = max;
   }

   var now = new Date().getTime();

   speed += (xyz - lastxyz) * (now-last) /1000;
   last = now;
   document.getElementById("speed").innerHTML = speed;
   if (speed > maxspeed) {
     maxspeed = speed;
     document.getElementById("maxspeed").innerHTML = maxspeed;
   }

   if ((xyz - lastxyz) > 15) {
     if (now - lastTime > 1000) {
       alert("shake");
       var shake = document.getElementById("shake");
       shake.innerHTML = "shake";
       setTimer(function(){
         shake.innerHTML = "";
       },1000);
     }
   }
   lastxyz = xyz;
   lastTime = now;

   //傾き
   var xg = evt.accelerationIncludingGravity.x; //左右
   var yg = evt.accelerationIncludingGravity.y; //上下
   var zg = evt.accelerationIncludingGravity.z; //前後

   //回転値
   var a = evt.rotationRate.alpha; //z方向
   var b = evt.rotationRate.beta; //x方向
   var g = evt.rotationRate.gamma; // y方向

    var html ="";
    html  += "x:"+x+"<br>";
    html += "y:"+y+"<br>";
    html += "z:"+z+"<br>";
    html  += "xyz:"+xyz+"<br>";

        html += "傾きx:"+xg+"<br>";
        html += "傾きy:"+yg+"<br>";
        html += "傾きz:"+zg+"<br>";

        html += "alpha(z):"+a+"<br>";
        html += "beta(x):"+b+"<br>";
        html += "gamma(y):"+g+"<br>";

   document.getElementById("rotation").innerHTML = html;

}, true);
function chkDef(){
  var count = 0;
  var a = new Array();
    function chkDefSpeed(evt){
      var x = evt.acceleration.x;
      var y = evt.acceleration.y;
      var z = evt.acceleration.z;
      var xx = x*x;
      var yy = y*y;
      var zz = z*z;
      var xyz = Math.sqrt( xx + yy + zz );
      a.push(xyz);

      count++;
      document.getElementById("count").innerHTML = count;
      if (count > 100) {
        var median = function(arr, fn) {
            var half = (arr.length/2)|0;
            var temp = arr.sort(fn);

            if (temp.length%2) {
                return temp[half];
            }

            return (temp[half-1] + temp[half])/2;
        };
        def = median(a);
        document.getElementById("def").innerHTML = def;
        window.removeEventListener('devicemotion', this);
      }
    }
  window.addEventListener("devicemotion", chkDefSpeed,true);

}

</script>
</head>
<body>
  <a href="javascript:chkDef()" id="start" onclick="chkDef()">start</a>
  <h4>speed</h4>
  <div id="speed" style="color:red"></div>
  <h4>max speed</h4>
  <div id="maxspeed" style="color:red"></div>
  <h4>max as</h4>
  <div id="max"></div>
  <div id="as"></div>
  <h4>def</h4>
  <div id="def" style="color:red"></div>
  <div id="count" style="color:red"></div>
  <h4>shake</h4>
  <div id="shake" style="color:red"></div>
<h2>位置情報を表示</h2>
<div id="geolocation">0</div>
<h2>コンパス値を表示</h2>
<div id="compass">0</div>
<h2>ジャイロセンサー値を表示</h2>
<div id="gyroscope">0</div>
<h2>加速度センサー値を表示</h2>
<div id="rotation">0</div>
</body>
</html>
